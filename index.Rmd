---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

## Starting fresh

```{r}
rm(list = ls()) # Remove all objects from the current R environment (clean workspace)
```

## Reading data

### opening a file from a url (file in Excel), name it 'fragility23'

```{r}
linkGit="https://github.com/DACSS-Fundamentals/overview/raw/refs/heads/main/FSI-2023-DOWNLOAD.xlsx" # Store the URL of the Excel file in a character variable
```



```{r}
#install.packages('rio')
library(rio)  # Load the 'rio' package (it provides import/export helpers)

fragility23=rio::import(file = linkGit)  # Download + read the Excel file from the URL into a data frame named `fragility23`

```

## First operations

```{r}
names(x = fragility23)                # Display the column names of the data frame

str(object = fragility23)             # Show the structure: column types, number of rows, and a preview of values

head(x = fragility23, 10)             # Show the first 10 rows of the data frame

tail(x = fragility23, 10)             # Show the last 10 rows of the data frame
```


## Transformative manipulation

```{r}
grep(pattern = "Country|S1|P1|E2|Total",
     x = names(fragility23),
     fixed = FALSE,
     value = TRUE)
                                      # Test: return the column names matching any of these patterns (regex OR with |)

keep <- grep("Country|S1|P1|E2|Total",
             names(fragility23),
             value = TRUE)
                                      # Save the matching column names into `keep`

frag23_sub <- fragility23[, keep]
                                      # Subset the data frame to keep only those selected columns; store as `frag23_sub`

names(frag23_sub)[3:5] <- c("S1", "E2", "P1")
                                      # Rename columns 3â€“5 (whatever they currently are) to S1, E2, and P1

tail(frag23_sub[order(x = -frag23_sub$E2), ], 10)
                                      # Order rows by E2 descending and show the last 10 rows (note: this is NOT top 10)

tail(frag23_sub[order(x = -frag23_sub$E2), "Country"], 10)
                                      # Same ordering, but show only the Country column for the last 10 rows

summary(object = frag23_sub)          # Produce summary stats (min/median/mean/quartiles) for each column

summary(object = frag23_sub)          # Produce summary stats (min/median/mean/quartiles) for each column

q3_Total <- quantile(x = frag23_sub$Total,
                     probs = 0.75,
                     na.rm = TRUE)
                                      # Compute the 75th percentile (Q3) of Total, ignoring missing values

cor(x = frag23_sub[, -c(1, 2)])       # Correlation matrix of numeric columns excluding Country (col 1) and Total (col 2)

# install.packages("corrtable")       # (Run once) Install corrtable if needed
library(corrtable)                    # Load corrtable for correlation matrices with significance tests

corrtable::correlation_matrix(df = frag23_sub[, -c(1, 2)])
                                      # Compute correlation matrix + p-values/significance for S1/E2/P1 (excluding Country/Total)

lm(S1 ~ P1 + E2, data = frag23_sub)   # Fit a linear model predicting S1 from P1 and E2 (prints a compact model object)

model <- lm(S1 ~ P1 + E2, data = frag23_sub)
                                      # Fit the same model but store it in `model` for reuse

summary(model)                        # Show full regression output: coefficients, standard errors, t-tests, R^2, etc.

```

## Some plotting 

```{r}
hist(x = frag23_sub$P1)               # Histogram of the P1 variable (base R)

plot(x = frag23_sub$S1, y = frag23_sub$E2)
                                      # Scatterplot of S1 (x-axis) vs E2 (y-axis)

frag23_sub$Total >= q3_Total          # Logical check (TRUE/FALSE) for each row: is Total in the worst (top) quartile?

frag23_sub$worstQt <- frag23_sub$Total >= q3_Total
                                      # Create a new logical column `worstQt` marking countries in the top quartile of Total

plot(frag23_sub$S1,
     frag23_sub$E2,
     pch = 20,
     col = as.factor(frag23_sub$worstQt))
                                      # Scatterplot with solid points; color points by worstQt group (TRUE vs FALSE)
```

## Visual of the regression P1 and E2 on S1

```{r}
# install.packages("sjPlot")          # (Run once) Install sjPlot if needed
library(sjPlot)                       # Load sjPlot for quick regression visualization

plot_models(model)                    # Plot the regression model estimates (e.g., coefficients with confidence intervals)
```
```{r}

# Boxplot of Total fragility score
# This shows the distribution and outliers of Total values
boxplot(frag23_sub$Total,
        main = "Distribution of Total Fragility Scores",
        ylab = "Total Score")
```


